{% extends "layout.html" %}
{% block title %}Cambio password{% endblock %}

{% block content %}
<div class="row">
  <div class="col s12">
    <h4 class="valign-wrapper" style="gap:8px">
      <i class="material-icons">lock</i> Cambio password
    </h4>
    <p class="grey-text text-darken-1">Aggiorna la tua password di accesso.</p>
  </div>

  <div class="col s12 m8 l6">
    <div class="card">
      <div class="card-content">
        <form method="post" novalidate>
          {% csrf_token %}

          {% if form.non_field_errors %}
          <div class="card-panel red lighten-5 red-text text-darken-2">
            {{ form.non_field_errors }}
          </div>
          {% endif %}

          <div class="input-field">
            {{ form.old_password }}
            <label for="{{ form.old_password.id_for_label }}">Password attuale</label>
            {% if form.old_password.errors %}
              <span class="helper-text red-text">{{ form.old_password.errors|striptags }}</span>
            {% endif %}
          </div>

          <div class="input-field">
            {{ form.new_password1 }}
            <label for="{{ form.new_password1.id_for_label }}">Nuova password</label>
            {% if form.new_password1.errors %}
              <span class="helper-text red-text">{{ form.new_password1.errors|striptags }}</span>
            {% else %}
              <span class="helper-text">
                {% for hint in form.password_validators_help_texts %}
                  â€¢ {{ hint }}<br>
                {% endfor %}
              </span>
            {% endif %}
          </div>

          <div class="input-field">
            {{ form.new_password2 }}
            <label for="{{ form.new_password2.id_for_label }}">Conferma nuova password</label>
            {% if form.new_password2.errors %}
              <span class="helper-text red-text">{{ form.new_password2.errors|striptags }}</span>
            {% endif %}
          </div>

          <div class="section" style="margin-top:20px">
            <button type="submit" class="btn waves-effect teal">
              <i class="material-icons left">check</i> Aggiorna
            </button>
            <a href="{% url 'profile' %}" class="btn-flat waves-effect">Annulla</a>
          </div>
          <div class="card yellow lighten-4 z-depth-1" style="margin-bottom:20px;">
            <div class="card-content black-text">
              <span class="card-title valign-wrapper" style="gap:6px;">
                <i class="material-icons small">info_outline</i>
                Consigli per una password sicura
              </span>
              <ul class="browser-default" style="margin-top:8px;">
                <li>La password deve contenere almeno <strong>8 caratteri</strong> tra lettere, numeri e simboli.</li>
                <li>Evita <strong>nomi, date o parole comuni</strong>.</li>
                <li>Non riutilizzare la password di altri servizi o password precedenti.</li>
                <li>Aggiorna periodicamente la password.</li>
                <li>Non condividerla e non salvarla su dispositivi condivisi.</li>
                <li>Se sospetti un accesso non autorizzato, cambiala subito o contatta l'Amministratore.</li>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_body %}
<script>
document.addEventListener('DOMContentLoaded', function(){
  // attiva label se i campi hanno valore (compatibile con Django)
  document.querySelectorAll('.input-field input').forEach(function(i){
    if(i.value) {
      var lbl = document.querySelector("label[for='"+ i.id +"']");
      if(lbl) lbl.classList.add('active');
    }
  });
});
</script>
{% endblock %}
