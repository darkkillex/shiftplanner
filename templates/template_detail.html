{% extends "layout.html" %}
{% load static %}
{% block title %}Template: {{ template.name }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col s12">
    <h4 class="valign-wrapper">
      <i class="material-icons left">description</i>{{ template.name }}
      {% if not template.is_active %}
        <span class="new badge red" data-badge-caption="disattivo"></span>
      {% endif %}
    </h4>
  </div>

<!-- Lista righe template -->
  <div class="col s12 m7">
    <ul class="collection" id="tpl-rows">
      {% for r in template.rows.all|dictsort:"order" %}
        <li class="collection-item valign-wrapper"
            data-row-id="{{ r.id }}"
            data-duty="{{ r.duty }}"
            data-template-id="{{ template.id }}">
          <div class="left">
            <span class="grey-text">#{{ r.order }}</span>
            {% if r.is_spacer %}
              <span class="chip grey lighten-3 black-text" style="margin-left:8px">[spazio]</span>
            {% else %}
              <span class="chip blue-grey lighten-5 black-text" style="margin-left:8px">{{ r.duty }}</span>
            {% endif %}
          </div>

          <div class="right">
            <button type="button"
                    class="btn-flat red-text js-row-delete"
                    data-template-id="{{ template.id }}"
                    data-row-id="{{ r.id }}"
                    title="Elimina riga">
              <i class="material-icons">delete</i>
            </button>
          </div>
        </li>
      {% empty %}
        <li class="collection-item">Nessuna riga nel template.</li>
      {% endfor %}
    </ul>
  </div>


  <!-- Form inserimento riga -->
  <div class="col s12 m5">
    <div class="card">
      <div class="card-content">
        <span class="card-title">Inserisci nuova riga</span>

        <div class="input-field">
          <select id="ref-row">
            <option value="" disabled selected>Scegli riga di riferimento</option>
            {% for r in template.rows.all|dictsort:"order" %}
              <option value="{{ r.id }}">#{{ r.order }} — {% if r.is_spacer %}[spazio]{% else %}{{ r.duty }}{% endif %}</option>
            {% endfor %}
          </select>
          <label>Riga di riferimento</label>
        </div>

        <div class="input-field">
          <select id="position">
            <option value="after" selected>Dopo</option>
            <option value="before">Prima</option>
          </select>
          <label>Posizione</label>
        </div>

        <p class="grey-text" style="margin-top:4px">
          Inserisci <code>duty</code> completo <em>oppure</em> solo la <code>base</code>.
          Se lasci <strong>duty</strong> vuoto e compili <strong>base</strong>,
          verrà generato automaticamente <code>base.next</code>.
        </p>

        <div class="input-field">
          <input id="duty" type="text" placeholder="Esempio: Ufficio.2">
          <label for="duty">Duty (opzionale)</label>
        </div>

        <div class="input-field">
          <input id="base" type="text" placeholder="Esempio: Ufficio">
          <label for="base">Base (usata se duty è vuoto)</label>
        </div>

      </div>
      <div class="card-action right-align">
        <a class="btn grey lighten-3 black-text" href="{% url 'templates_area' %}">
          <i class="material-icons left">chevron_left</i>Indietro
        </a>
        <button id="btn-insert" class="btn waves-effect">
          <i class="material-icons left">add</i>Inserisci
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_body %}
<script> const templateId = {{ template.id }}; </script>
<script src="{% static 'core/template_detail.js' %}"></script>
{% endblock %}
